# Technical Specification — Cat Health Tracker (Nova Calder)

This document translates the "calm, photo-first" Product Shape into a functional, reliable, and minimal technical architecture.

---

## 1. Minimal System Architecture

### Frontend (PWA)
- **Framework**: Next.js (Static Export or Vercel hosted) for fast, PWA-ready performance.
- **State Management**: Local React state + SWR/TanStack Query for data fetching.
- **Camera Access**: Native browser `input type="file" accept="image/*" capture="environment"` for maximum compatibility and low friction.

### Backend (The "Boring" Stack)
- **API Strategy**: Serverless Functions (Next.js API routes) to minimize maintenance.
- **Database**: PostgreSQL (Supabase or Neon) for structured logging.
- **Auth**: Simple Magic Link (Supabase Auth) — reduces "anxiety" of remembering passwords.

### Storage (Photo-First)
- **Service**: Cloudinary or Supabase Storage (S3 wrapper) with automatic resizing for "instant" loading on the Timeline.

---

## 2. Data Model

### Entity: `cat`
| Field | Type | Required | Notes |
| :--- | :--- | :--- | :--- |
| `id` | UUID | Yes | Primary Key |
| `owner_id` | UUID | Yes | FK to local User |
| `name` | String | Yes | Cat's name |
| `created_at` | Timestamp | Yes | |

### Entity: `check_in`
| Field | Type | Required | Notes |
| :--- | :--- | :--- | :--- |
| `id` | UUID | Yes | Primary Key |
| `cat_id` | UUID | Yes | FK to `cat` |
| `photo_url` | String | Yes | Pointer to Storage |
| `vibe_score` | Integer | Yes | 1-5 Scale |
| `appetite` | Integer | No | 1-5 Scale (Optional) |
| `energy` | Integer | No | 1-5 Scale (Optional) |
| `litter_box` | Enum | No | `normal`, `diarrhea`, `constipated`, `blood` |
| `notes` | Text | No | |
| `timestamp` | Timestamp | Yes | Default: `now()` |

---

## 3. Core API Surface

### `POST /api/check-in`
- **Request**: `Multipart/form-data` (Photo file + JSON metadata).
- **Processing**: Upload photo -> Store URL -> Save record in SQL.
- **Response**: `201 Created` with the saved check-in object.

### `GET /api/timeline`
- **Params**: `cat_id`, `limit`, `offset`.
- **Response**: Paginated list of `check_in` objects, ordered by `timestamp DESC`.

### `GET /api/cat/:id`
- **Response**: `cat` object + calculated `normal_baseline` (14-day rolling average of vibe/appetite).

### `GET /api/export`
- **Output**: JSON or simple HTML (to be styled by Frontend as PDF).
- **Content**: Summary of the last 30 days of check-ins.

---

## 4. Execution Order (Dependency First)

### Phase 1: The Pulse
1. **DB Setup**: Initialize `cat` and `check_in` tables.
2. **Photo Storage**: Connect Storage bucket and verify upload permissions.
3. **Check-in API**: End-to-end test (Upload photo + Vibe 3 -> Verify DB entry).

### Phase 2: The View
1. **Timeline API**: Fetch and paginate logs.
2. **Timeline Screen**: Render visual feed of photos + vibes.
3. **PWA Shell**: Ensure manifest and icons work on mobile home screen.

### Phase 3: The Support
1. **Profile Logic**: Basic CRUD for `cat` name and baseline calculation.
2. **Export Logic**: Generate the summary data object.

---

## 5. Technical Guardrails (Nova)
- **No Multi-Cat**: DB schema enforced for single `cat_id` per user query in V1.
- **Safety First**: Store raw timestamps; let Frontend handle local display.
- **Minimal AI Integration**: Iris will receive the `photo_url` for analysis later; Nova only handles the delivery.
